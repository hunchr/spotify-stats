<% if @spotify_info %>
  <%= image_tag @spotify_info["album"]["images"][1]["url"], alt: t("labels.cover"), width: 160 %>
<% end %>

<%= render "shared/table" do %>
  <tr>
    <th><%= t "columns.artist_name" %></th>
    <td><%= link_to @song.artist.name, artist_path(@song.artist) %></td>
  </tr>
  <tr>
    <th><%= t "columns.title" %></th>
    <td><%= @song.title %></td>
  </tr>
  <% if @spotify_info %>
    <tr>
      <th><%= t "labels.release_date" %></th>
      <td><%= @spotify_info.dig "album", "release_date" %></td>
    </tr>
    <tr>
      <th><%= t "labels.popularity" %></th>
      <td><%= @spotify_info["popularity"] %>%</td>
    </tr>
  <% end %>
  <tr>
    <th><%= t "labels.uri" %></th>
    <td><%= link_to @song.uri, "https://open.spotify.com/track/#{@song.uri}",
              rel: :noopener, target: :_blank %></td>
  </tr>
<% end %>

<% if @vocadb_info %>
  <h2><%= t "labels.vocadb" %></h2>
  <%= render "shared/table" do %>
    <tr>
      <th><%= t "columns.artist_name" %></th>
      <td><%= @vocadb_info["artistString"] %></td>
    </tr>
    <tr>
      <th><%= t "columns.title" %></th>
      <td><%= @vocadb_info["defaultName"] %></td>
    </tr>
    <tr>
      <th><%= t "labels.release_date" %></th>
      <td><%= @vocadb_info["publishDate"].to_date %></td>
    </tr>
    <tr>
      <th><%= t "labels.popularity" %></th>
      <td><%= @vocadb_info["ratingScore"] %></td>
    </tr>
    <tr>
      <th><%= t "labels.genres" %></th>
      <td><%= @vocadb_info["genres"].to_sentence %></td>
    </tr>
    <tr>
      <th><%= t "labels.themes" %></th>
      <td><%= @vocadb_info["themes"].to_sentence %></td>
    </tr>
    <tr>
      <th><%= t "labels.uri" %></th>
      <td><%= link_to @vocadb_info["id"], "https://vocadb.net/S/#{@vocadb_info["id"]}",
                rel: :noopener, target: :_blank %></td>
    </tr>
  <% end %>
<% end %>

<h2><%= t "stats.title" %></h2>
<%= render "shared/table" do %>
  <tr>
    <th><%= t "stats.total_plays" %></th>
    <td class="text-right"><%= t "stats.plays_count", count: @plays.length %></td>
  </tr>
  <tr>
    <th><%= t "stats.total_duration" %></th>
    <td class="text-right"><%= duration_in_words @plays.sum(&:ms_played) %></td>
  </tr>
  <tr>
    <th><%= t "columns.first_played_at" %></th>
    <td class="text-right"><%= format_date @plays.first.created_at %></td>
  </tr>
  <tr>
    <th><%= t "columns.last_played_at" %></th>
    <td class="text-right"><%= format_date @plays.last.created_at %></td>
  </tr>
<% end %>

<h2><%= t "stats.most_plays_in" %></h2>
<%= render "shared/table" do %>
  <% ApplicationHelper::DATE_FORMAT.each do |time, format| %>
    <tr>
      <th><%= t "labels.#{time}" %></th>
      <td class="text-right"><%= @most_plays[time].to_date.strftime format %></td>
      <td class="text-right"><%= t "stats.plays_count", count: @most_plays["#{time}_count"] %></td>
    </tr>
  <% end %>
<% end %>

<h2><%= t "labels.plays" %></h2>
<table>
  <thead>
    <tr>
      <% %w[index date plays_length].each do |attr| %>
        <th><%= t "columns.#{attr}" %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @plays.each_with_index do |play, index| %>
      <tr>
        <td class="text-right"><%= index.next %></td>
        <td><%= format_time play.created_at %></td>
        <td class="text-right"><%= format_duration play.ms_played %></td>
      </tr>
    <% end %>
  </tbody>
</table>
